# UseCase1: Classic ARM DevOps Pipeline
# Simple Build -> Publish Artifacts pattern (no Azure deployment)

trigger:
- main

variables:
  buildConfiguration: 'Release'

jobs:
- job: 'Build'
  displayName: 'Build the web application'
  pool:
    vmImage: 'ubuntu-latest'
  variables:
    dotnetSdkVersion: '8.x'
  steps:
  - task: UseDotNet@2
    displayName: 'Use .NET SDK $(dotnetSdkVersion)'
    inputs:
      packageType: 'sdk'
      version: '$(dotnetSdkVersion)'

  - task: DotNetCoreCLI@2
    displayName: 'Restore project dependencies'
    inputs:
      command: 'restore'
      projects: 'Tailspin.SpaceGame.Web/Tailspin.SpaceGame.Web.csproj'

  - task: DotNetCoreCLI@2
    displayName: 'Build the project - $(buildConfiguration)'
    inputs:
      command: 'build'
      arguments: '--no-restore --configuration $(buildConfiguration)'
      projects: 'Tailspin.SpaceGame.Web/Tailspin.SpaceGame.Web.csproj'

  - task: DotNetCoreCLI@2
    displayName: 'Publish the project - $(buildConfiguration)'
    inputs:
      command: 'publish'
      projects: 'Tailspin.SpaceGame.Web/Tailspin.SpaceGame.Web.csproj'
      arguments: '--no-build --configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)/$(buildConfiguration)'
      zipAfterPublish: true

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifacts'
    inputs:
      pathToPublish: '$(Build.ArtifactStagingDirectory)'
      artifactName: 'drop'